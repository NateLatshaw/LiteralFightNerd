---
title: "Introducing Expected Rounds (xR)"
description: |
  A new advanced metric measuring UFC fighter success by round
twitter:
  - site: "@NateLatshaw"
  - creator: "@NateLatshaw"
author:
  - name: Nate Latshaw
date: 02-28-2021
output:
  distill::distill_article:
    self_contained: false
    toc: true
draft: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, include = F}
rm(list = ls())
gc()

library(data.table)
library(lubridate)
library(ggplot2)
library(RColorBrewer)
library(scales)
library(kableExtra)

data_path <- '../../_supplemential_files/2021-02-28-introducing-expected-rounds-xr/input_files/'

# plot aesthetics
paired_colors4 <- brewer.pal(6, 'Paired')[c(6,5,2,1)]

# load data
rounds <- readRDS(paste0(data_path, 'round_stats_20210228.RDS'))
fights <- readRDS(paste0(data_path, 'fight_stats_20210228.RDS'))

```

# Introduction

### Current quantitative fighter evaluation limitations

Quantitative mixed martial arts (MMA) analysis features two common challenges: dealing with small samples sizes and capturing the nuance that is inherent to the sport.

In general, fighters do not have many professional MMA fights, and among their limited number of fights, the Ultimate Fighting Championship (UFC) is really the only MMA promotion that tracks striking and grappling statistics from within each fight (though there are some exceptions). Hence, the amount of data that can be collected on each professional UFC fighter is limited, which makes quantitative analysis difficult.

Further, MMA is a sport that features many different fighting styles and techniques that are difficult to quantify. Fights can end at any moment via knockout or submission, so there a number of paths to victory for fighters that possess expertise in multiple MMA disciplines. However, finishing ability is not the only signal of dominance in MMA. Proper fighter evaluation metrics should not only rely on finishing ability but should also capture other forms of dominance inside the octagon.

Currently, fighters are frequently evaluated on their win percent (the number of fights won divided by total number of fights) and finish percent (the number of fights won via knockout or submission divided by the number of fights won). However, both of these metrics are limited. In addition to small sample size limitations, win percent fails to differentiate between close wins, dominant wins, and judging blunders. Finish percent measures a fighter's ability to finish a fight, but as a broader measure of fighter dominance, it does not account for dominant wins by decision, which are arguably just as impressive as a finish.

### Pushing the envelope with xR

Enter expected rounds (xR) and expected round percent (xR%), new advanced metrics that aim to address the sample size and nuance issues that typically plague other fighter evaluation metrics. There are many reasons why I believe the MMA community could benefit from these metrics.

First and foremost, as an advanced metric, xR is interpretable and easy to understand: 

**xR is the number a rounds a fighter would expect to have won, on average, given his or her round-by-round performances**.

That's it. Anyone who can understand that is capable of adopting this metric. The accompanying metric xR% is then just as straightforward:

**xR% is the percent of rounds a fighter would expect to have won, on average, given his or her round-by-round performances**.

The rest of this post will cover the methodological details of these metrics and then step through a number of reasons why MMA audiences of all types should care. However, I want it to be stated clearly up front that these are advanced metrics that are approachable for everyone. If the technical details of these metrics do not interest you, feel free to skip over that section. *You do not need to understand precisely how these metrics are computed in order to understand what they seek to measure and how they improve over current mainstream metrics like win percent and finish percent.*

### Why you should care about xR

Before jumping into the methodology, below I've listed the five most significant reasons why I believe xR and xR% should be embraced by the MMA community. The first reason, simplicity, has already been covered. It is my job in this post to convince readers of the remaining four reasons.

1. xR and xR% are easy to understand and interpret
2. xR% is more informative than win percent and finish percent
3. xR% is more predictive than win percent and finish percent
4. xR% is more stable than win percent and finish percent
5. xR and xR% are more robust to judging blunders than wins and win percent

# xR methodology

The xR metric is an extension of a machine learning algorithm I developed in a [previous blog post](https://literalfightnerd.com/posts/2021-02-19-introducing-judgeai/). That model uses official UFC round-level striking and grappling statistics to predict judges' scores by round. As demonstrated in that post, the model is able to predict round scores with a high degree of accuracy and generate well-calibrated probabilities for each possible round score. That is, for each round in the UFC, we can use the model to recover the probability that the judges will score that round 10-9, 10-8, 9-10, or 8-10. Then, using these round score probabilities, we can compute the probability of each fighter winning that round.

For each round that does not end via knockout or submission, xR is simply the probability that that fighter won the round. Hence, xR treats each round as a single point that is up for grabs and uses round win probabilities to partition that point between the two fighters. Then, for rounds that ends in a knockout or submission, the winning fighter's xR for that round is 1 and the losing fighter's xR for that round is 0. The equation below defines xR for a given fighter as a piece-wise function.

**xR for a given fighter and round:**
\begin{equation}
xR = 
\begin{cases} 
0 & \text{if fighter loses by knockout/submission} \\
\text{round win probability} & \text{if round goes the distance} \\
1 & \text{if fighter wins by knockout/submission}
\end{cases}
\end{equation}

Then, xR% is computed by adding up a given fighter's xR across all rounds and then dividing by the number of rounds fought. Notice that xR is computed by round, so a fighter who wins a fight via a second round submission will likely not capture all available xR for that fight. Instead, the first round's xR will be partitioned according to each fighter's round win probability, and then all of the second round's xR will be given to the fighter who won by submission.

More concretely, consider Table \@ref(tab:hypothetical-xr) below of a hypothetical fight between Fighter A and Fighter B where Fighter A lands fewer strikes in the first round than his opponent but then wins by submission in the second. Here we see that xR is computed for each round independently of all other rounds. Then, aggregating xR up to the fight level yields the number of rounds each fighter could expect to win, on average, given their performances in each round. Even though Fighter B landed more strikes in the first round, there is uncertainty in how the judges would have scored this round, so Fighter A still gets some credit for that round. However, since Fighter A earned a submission in the second round, the entire round's worth of xR goes to him. Thus, on average Fighter A could expect to win 1.4 rounds if this exact fight was fought many times - sometimes he would lose the first round on the judges' scorecard but other times he would win it. Some of the uncertainty in how rounds are scored is captured in xR, which separates it from traditional metrics like win percent and finish percent.

Finally, we see that xR% is computed by adding each fighter's xR across rounds and then dividing by the number of rounds fought. At the fight level, this tells us what percent of rounds each fighter could expect to win given their round-level performances. Computing xR% over a fighter's career would then describe how dominant that fighter has been by round, which again separates xR from win percent and finish percent. In the hypothetical example below, if this was Fighter A's first fight, his win and finish percents would be 100%, but his xR would only be 70%, which would better reflect his body of work since it accounts for first round where he likely lost. 

```{r hypothetical-xr}
tbl_df <- data.table(Fighter = c('A', 'B'), 
                     'Round 1 xR' = c('0.4', '0.6'), 
                     'Round 2 xR' = c('1.0', '0.0'), 
                     'Fight xR' = c('0.4 + 1.0 = 1.4', '0.6 + 0.0 = 0.6'), 
                     'Fight xR%' = c('1.4 / 2 = 0.7 = 70%', '0.6 / 2 = 0.3 = 30%'))

kable(tbl_df, format = 'html', caption = 'xR for a hypothetical fight', align = 'c', booktabs = T) %>%
  kable_styling(bootstrap_options = c('striped'), full_width = T, font_size = 24) %>% 
  footnote('-In this example, Fighter A wins in the second round via submission.')
```

Again, if you are interested in understanding the technical details of how each fighter's round win probability is computed, feel free to check out my [previous blog post](https://literalfightnerd.com/posts/2021-02-19-introducing-judgeai/) that provides a detailed overview of the algorithm and its performance.

# xR is informative

As an example, Table \@ref(tab:ufc-245-xr) below shows the xR breakdown for the UFC 245 main event between Kamaru Usman and Colby Covington. The fight was close heading into the fifth round where Usman won by knockout. Conventional metrics like win percent and finish percent assign this fight as a 1 for Usman and a 0 for Colby. However, those metrics lose a significant amount of information, which is exactly why we turn to xR. According to the algorithm, Colby had a 68.9% probability of winning the first round on the judges' scorecard, so his xR for this round is 0.689. No matter what happens in subsequent rounds, Colby retains this xR for that round.

```{r ufc-245-xr}

tbl_df <- rounds[F1_Name == 'Kamaru Usman' & F2_Name == 'Colby Covington', .(Round, 
                                                                             Champion = F1_Name, 
                                                                             'Champion xR' = format(round(F1_xR, 3), nsmall = 3), 
                                                                             Challenger = F2_Name, 
                                                                             'Challenger xR' = format(round(F2_xR, 3), nsmall = 3))]


kable(tbl_df, format = 'html', caption = 'xR of UFC 245 main event', align = 'c', booktabs = T) %>%
  kable_styling(bootstrap_options = c('striped'), full_width = T, font_size = 24)

```

By using each round as the unit of observation, xR can be aggregated across rounds in a single fight to get a clearer picture of how close the fight was. 

```{r ufc-245-xr-percent}

tbl_df <- rbind(fights[F1_Name == 'Kamaru Usman' & F2_Name == 'Colby Covington', .(Fighter = F1_Name, 
                                                                                   xR = format(round(F1_xR, 2), nsmall = 2), 
                                                                                   'xR%' = paste0(format(100 * round(F1_xR / EndRound, 3), nsmall = 1), '%'))], 
                fights[F1_Name == 'Kamaru Usman' & F2_Name == 'Colby Covington', .(Fighter = F2_Name, 
                                                                                   xR = format(round(F2_xR, 2), nsmall = 2), 
                                                                                   'xR%' = paste0(format(100 * round(F2_xR / EndRound, 3), nsmall = 1), '%'))])


kable(tbl_df, format = 'html', caption = 'Total xR and xR%', align = 'c', booktabs = T) %>%
  kable_styling(bootstrap_options = c('striped'), full_width = T, font_size = 24) %>% 
  footnote('-This table presents xR and xR% at the fight level.')

```

# xR is predictive
# xR is stable
# xR is robust

# Conclusion